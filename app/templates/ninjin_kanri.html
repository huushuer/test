{% extends "base.html" %}

{% block title %}
äººå‚é€šè²¨ç®¡ç†
{% endblock %}

{% block content %}
<!-- ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šheaderï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š -->
{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/ninjin_kanri.css') }}">
{% endblock %}
<!-- /header -->
<!-- ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š -->
<!-- ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šè£…é£¾ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š -->
<!-- /è£…é£¾ -->

<!-- ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šã‚¿ã‚¤ãƒˆãƒ«ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š -->
<div class="main">
    {% include "navigation.html" %}
    <h1 class="main__title">ãƒ‹ãƒ³ã‚¸ãƒ³é€šè²¨ç®¡ç†</h1>
    <p class="margin"></p>
    <div class="kanri__wrapper">
        {# å·¦æ®µ #}
        <div class="wrapper__left">
            <div class="left__contents">
                {% if session.get('child_account') %}
                <input type="hidden" id="child-account">
                <p id="r0-link">ãƒ‹ãƒ³ã‚¸ãƒ³æƒ…å ±</p>
                <p id="r3-link">è³¼å…¥å±¥æ­´</p>
                {% else %}
                <p id="r0-link">ãƒ‹ãƒ³ã‚¸ãƒ³æƒ…å ±</p>
                <p id="r1-link">å­ä¾›ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ä»˜ä¸</p>
                <p id="r2-link">ãƒ‹ãƒ³ã‚¸ãƒ³é€šè²¨è³¼å…¥</p>
                <p id="r3-link">è³¼å…¥å±¥æ­´</p>
                {% endif %}
            </div>
        </div>

        {# å³æ®µ #}
        <div class="wrapper__right">
            <div class="right__top">
                <div class="rtop__img">
                    {# ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ¡ãƒ¼ã‚¸ #}
                    <img src="{{ url_for('static', filename='images/icon/' ~ session.get('icon')) }}" alt="">
                </div>
                <div class="rtop__name">
                    <p>{{session.get('name')}}</p>
                </div>
            </div>
            <div class="right__bottom">
                {# ã«ã‚“ã˜ã‚“åŸºæœ¬æƒ…å ±â€»å³0 #}
                <div class="right__0" id="right__0">
                    <div class="r0_contents">
                        <div class="r0__current">
                            <h2>ç¾åœ¨ã®ã«ã‚“ã˜ã‚“</h2>
                            {{ninjin}}
                        </div>
                        <div class="r0__history">

                            {# ãƒ‹ãƒ³ã‚¸ãƒ³è³¼å…¥å±¥æ­´ã‚’foræ–‡ã§å‡ºã™ #}
                            {%if not ninjin_historys%}
                            <p class="none_info">ã«ã‚“ã˜ã‚“å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
                            <img src="../static/images/shop_pandax1_bg.png" alt="">
                            {%else%}
                            <h2>ã«ã‚“ã˜ã‚“å±¥æ­´</h2>
                            <table>
                                <thead>
                                    <th scope="col">æ—¥ä»˜</th>
                                    <th scope="col">æ¦‚è¦</th>
                                    <th scope="col">ãƒãƒ£ãƒ¼ã‚¸</th>
                                    <th scope="col">æ”¯å‡º</th>
                                </thead>
                                <tbody>
                                    {% for ninjin_history in ninjin_historys %}
                                    <tr>
                                        <td class="table__date">
                                            {{ninjin_history.date}}
                                        </td>
                                        <td class="table__subject">
                                            {{ninjin_history.subject}}
                                        </td>
                                        <td class="table__charge">
                                            {{ninjin_history.charge}}
                                        </td>
                                        <td class="table__expence" style="color: red;">
                                            {{ninjin_history.expence}}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {%endif%}
                        </div>
                    </div>
                </div>
                {% if not session.get('child_account') %}
                {# å­ä¾›ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ‹ãƒ³ã‚¸ãƒ³ã‚’ä»˜ä¸ã™ã‚‹ãƒšãƒ¼ã‚¸â€»å³1 #}
                <div class="right__1" id="right__1">
                    <div class="r1__contents">
                        {# ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚’ä½œæˆ #}
                        {# https://zenweb.info/frontend/accordion-panel/ #}
                        <ul class="r1__accordion__list">
                            {# foræ–‡ #}
                            {%if not child_infos%}
                            <p class="none_info">å­ä¾›ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>
                            <img src="../static/images/shop_pandax1_bg.png" alt="">
                            {%endif%}
                            {% for child_info in child_infos %}
                            <li class="r1__accordion__item">
                                <div class="r1__accordion__head">
                                    <div class="r1__accordion__head__img">
                                        {% if child_info.F_icon %}
                                        <img src="{{ url_for('static', filename='images/icon/' ~ child_info.F_icon) }}"
                                            alt="">
                                        {% else %}
                                        <img src="{{ url_for('static', filename='images/icon/default_icon.jpg') }}"
                                            alt="">
                                        {% endif %}

                                    </div>
                                    <div class="r1__accordion__head__name">
                                        <p>{{child_info.F_MemberName}}</p>
                                    </div>
                                </div>
                                <div class="r1__accordion__body">
                                    <form action="{{url_for('ninjin_kanri_r1')}}" method="POST">
                                        <input type="hidden" value="{{child_info.F_MemberID}}" name="child_id">
                                        <p class="r1__accordion__body__text">
                                            ğŸ¥•{{child_info.F_MemberName}}ã•ã‚“ã®æ®‹é«˜ï¼š{{child_info.F_Carrot}}</p>
                                        <input type="number" placeholder="ä»˜ä¸é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" name="child_okodukai"
                                            id="{{child_info.F_MemberID}}" min="1" max="{{ninjin}}"
                                            class="r1__accordion__body__inputNumber"><br>
                                        <input type="submit" value="ãŠã“ã¥ã‹ã„ã‚’ã‚ã’ã‚‹" class="r1__accordion__body__submit">
                                    </form>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {# ãƒ‹ãƒ³ã‚¸ãƒ³é€šè²¨è³¼å…¥ãƒšãƒ¼ã‚¸â€»å³2 #}
                <div class="right__2" id="right__2">
                    <div class="r2__top">
                        <p>ğŸ¥•ç¾åœ¨ã®æ®‹é«˜ğŸ¥•</p>
                        <p>ğŸ¥•ãƒãƒ£ãƒ¼ã‚¸å¾ŒğŸ¥•</p>
                        <p class="r2__current_ninjin">{{ninjin}}</p>
                        <p id="sum_price"></p>
                    </div>
                    <form action="{{url_for('ninjin_kanri_r2')}}" method="POST">
                        <input type="hidden" value="" id="updated_ninjin" name="updated_ninjin">
                        <div class="r2__bottom">
                            <div class="r2__form_label">
                                <input type="radio" id="1000" name="radio_charge" value="1000" class="r2__form_radio">
                                <label for="1000">1,000å††</label>
                            </div>
                            <div class="r2__form_label">
                                <input type="radio" id="2000" name="radio_charge" value="2000" class="r2__form_radio">
                                <label for="2000">2,000å††</label>
                            </div>
                            <div class="r2__form_label">
                                <input type="radio" id="3000" name="radio_charge" value="3000" class="r2__form_radio">
                                <label for="3000">3,000å††</label>
                            </div>
                            <div class="r2__form_label">
                                <input type="radio" id="5000" name="radio_charge" value="5000" class="r2__form_radio">
                                <label for="5000">5,000å††</label>
                            </div>
                            <div class="r2__form_label">
                                <input type="radio" id="8000" name="radio_charge" value="8000" class="r2__form_radio">
                                <label for="8000">8,000å††</label>
                            </div>
                            <div class="r2__form_label">
                                <input type="radio" id="10000" name="radio_charge" value="10000" class="r2__form_radio">
                                <label for="10000">10,000å††</label>
                            </div>
                            <input type="number" placeholder="ãã®ä»–ã®é‡‘é¡" class="other_charge" name="other_charge" min="0">
                            <div class="r2__bank-info">
                                <p>æ”¯æ‰•ã„æ‰‹æ®µï¼šã­ã“éŠ€è¡Œ|èŒ¶ãƒˆãƒ©æ”¯åº—</p>
                                <p>â–³â–³â–³â–³â–³â–³â–³â–³â–³â–³â–³â–³|âœ•âœ•âœ•</p>
                            </div>
                            <input type="submit" value="ãƒãƒ£ãƒ¼ã‚¸" class="input-submit-button">
                        </div><!-- r2__bottom -->
                    </form>
                </div>
                {% endif %}
                {# è³¼å…¥å±¥æ­´ç¢ºèªãƒšãƒ¼ã‚¸â€»å³3 #}
                <div class="right__3" id="right__3">
                    <div class="r3_goods_wrapper">
                        {%if not purchase_dates%}
                        <p class="none_info">è³¼å…¥å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
                        <img src="../static/images/shop_pandax1_bg.png" alt="">
                        {%endif%}
                        {% for purchase_date in purchase_dates %}
                        <h3 class="r3_goods_date">{{purchase_date.date}}</h3>
                        {% for purchase in purchases %}
                        {% if purchase_date.date == purchase.date %}
                        <div class="r3_goods">
                            <div class="r3_goods_img">
                                <img src="{{url_for('static',filename='images/' ~ purchase.F_ImageName)}}" alt="">
                            </div>
                            <div>
                                <p>{{purchase.F_GoodsName}}</p>
                            </div>
                            <div>
                                <p>å€‹æ•°ï¼š{{purchase.F_PurchaseNum}}</p>
                            </div>
                        </div>
                        {% else %}
                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div><!-- main -->

    <!-- ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šfooterï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š -->
    {#{% include "footer.html" %}#}
    <!-- /footer -->
    <script>
        // ãƒ‹ãƒ³ã‚¸ãƒ³é€šè²¨è³¼å…¥ãƒšãƒ¼ã‚¸ã®å‡¦ç†
        // ãƒãƒ£ãƒ¼ã‚¸å¾Œã®é‡‘é¡ã‚’å‡ºã™
        $(document).ready(function () {
            var charge = 0
            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆè¨ˆé‡‘é¡ã‚’è¨ˆç®—ã—ã€è¡¨ç¤ºã™ã‚‹
            sumAddPrice(charge);
            $('input[name="radio_charge"]').change(function () {
                $('.other_charge').val(''); // other_chargeã®å€¤ã‚’0ã«ã™ã‚‹å‡¦ç†ã‚’å…¥ã‚Œã‚‹
                var charge = $(this).val();
                sumAddPrice(charge);
            });
            $('input[type="number"]').change(function () {
                $('input[name="radio_charge"]:checked').prop('checked', false); // radioã®checkã‚’å¤–ã™
                var charge = $(this).val();
                sumAddPrice(charge);
            });
        });
        function sumAddPrice(charge) {
            // ãã®ä»–ã®é‡‘é¡ã«å…¥åŠ›ã•ã‚Œã¦ã„ãŸå ´åˆã€radioã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ã€åŠ ç®—ã—ãªã„
            let other_charge = $('.other_charge').val();
            let current_ninjin = $('.r2__current_ninjin').text();
            if (other_charge > 0) {
                // ãã®ä»–ã®é‡‘é¡ã«å…¥åŠ›ã•ã‚ŒãŸéš›ã®å‡¦ç†
                totalPrice = parseInt(current_ninjin) + parseInt(other_charge)
                $('#sum_price').text(totalPrice);
                $('#flask_getter_charge').val(totalPrice);
                $('#updated_ninjin').val(totalPrice);
            } else {
                // radioãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸéš›ã®å‡¦ç†
                totalPrice = parseInt(current_ninjin) + parseInt(charge)
                $('#sum_price').text(totalPrice);
                $('#updated_ninjin').val(totalPrice);
            }
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const childAccountElement = document.getElementById('child-account');
            let childAccount = false;
            if (childAccountElement) {
                childAccount = childAccountElement.dataset.childAccount == 'True';
            }

            const r0Link = document.getElementById("r0-link");
            const r1Link = document.getElementById("r1-link");
            const r2Link = document.getElementById("r2-link");
            const r3Link = document.getElementById("r3-link");

            if (childAccount) {
                if (r1Link) r1Link.remove();
                if (r2Link) r2Link.remove();
            }

            // ãƒªãƒ³ã‚¯å‰Šé™¤å¾Œã«contentsã‚’å†é¸æŠ
            const contents = document.querySelectorAll("#right__0, #right__1, #right__2, #right__3");
            const links = [r0Link, r1Link, r2Link, r3Link].filter(link => link !== null); // ãƒªãƒ³ã‚¯ã®filterã¯contentsã®å†é¸æŠå¾Œã«è¡Œã†


            // ãƒªãƒ³ã‚¯ã®ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´ (åˆæœŸè¡¨ç¤ºæ™‚ã®ã¿)
            if (childAccount) {
                if (r3Link) r3Link.textContent = "è³¼å…¥å±¥æ­´";
                if (r0Link) r0Link.textContent = "ãƒ‹ãƒ³ã‚¸ãƒ³æƒ…å ±";
            } else {
                if (r1Link) r1Link.textContent = "å­ä¾›ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ä»˜ä¸";
                if (r2Link) r2Link.textContent = "ãƒ‹ãƒ³ã‚¸ãƒ³é€šè²¨è³¼å…¥";
                if (r3Link) r3Link.textContent = "è³¼å…¥å±¥æ­´";
                if (r0Link) r0Link.textContent = "ãƒ‹ãƒ³ã‚¸ãƒ³æƒ…å ±";
            }

            // const links = [r0Link, r1Link, r2Link, r3Link].filter(link => link !== null);
            // const contents = document.querySelectorAll("#right__0, #right__1, #right__2, #right__3");

            // åˆæœŸè¡¨ç¤º
            contents.forEach((content, index) => {
                content.hidden = index !== 0;
            });
            if (links[0]) links[0].style.backgroundColor = '#7EA77F';

            links.forEach((link, index) => {
                link.addEventListener('click', () => {
                    // è‰²ã®åˆ‡ã‚Šæ›¿ãˆ
                    links.forEach(l => {
                        if (l) l.style.backgroundColor = 'rgba(255, 255, 255, 0)';
                    });
                    link.style.backgroundColor = '#7EA77F';

                    // è¡¨ç¤º/éè¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
                    contents.forEach(c => c.hidden = true);
                    contents[index].hidden = false;
                    console.log(contents[index])
                });

                link.addEventListener('mouseover', () => {
                    if (link.style.backgroundColor !== 'rgb(126, 167, 127)') {
                        link.style.backgroundColor = '#7ea77fc4';
                    }
                });

                link.addEventListener('mouseleave', () => {
                    if (link.style.backgroundColor !== 'rgb(126, 167, 127)') {
                        link.style.backgroundColor = 'rgba(255, 255, 255, 0)';
                    }
                });
            });
        });


        // r1ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³
        "use strict";

        const accordionItems = document.getElementsByClassName("r1__accordion__item");
        const accordionBtns = document.getElementsByClassName("r1__accordion__head");

        for (let i = 0; i < accordionBtns.length; i++) {
            accordionBtns[i].addEventListener("click", function () {
                accordionItems[i].classList.toggle("active");
            });
        }

    </script>
    {% endblock %}